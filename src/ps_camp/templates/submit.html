{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/submit.css') }}">
<script src="{{ url_for('static', filename='js/submit.js') }}"></script>

<div class="submit-container">
  {% if role == "party" %}
  <div class="submit-header">
    <h2>å€™é¸äººæå</h2>
    <p>å‰©é¤˜åé¡ï¼š<span id="remaining">{{ remaining_slots }}</span> / 6</p>
  </div>

  {% if remaining_slots == 0 %}
  <p class="limit-warning">æ‚¨å·²æå 6 ä½å€™é¸äººï¼Œç„¡æ³•å†æ–°å¢ã€‚</p>
  {% endif %}

  <form method="POST" enctype="multipart/form-data" class="submit-form">
    <table class="member-table">
      <thead>
        <tr>
          <th>é¸æ“‡</th>
          <th>å§“å</th>
          <th>å¸³è™Ÿ</th>
        </tr>
      </thead>
      <tbody>
        {% for member in members %}
        {% if member.id not in existing_candidates | map(attribute='user_id') | list %}
        <tr>
          <td><input type="radio" name="selected_member" value="{{ member.id }}" required></td>
          <td>{{ member.fullname }}</td>
          <td>{{ member.username }}</td>
        </tr>
        {% endif %}
        {% endfor %}
      </tbody>
    </table>

    <label for="description">æ”¿è¦‹ï¼ˆé¸å¡«ï¼‰</label>
    <textarea name="description" rows="4" placeholder="è«‹è¼¸å…¥è©²å€™é¸äººçš„æ”¿è¦‹..."></textarea>

    <label>ä¸Šå‚³å€™é¸äººç…§ç‰‡ï¼ˆé¸å¡«ï¼‰</label>
    <input type="file" name="photo" accept="image/*">

    <label>ä¸Šå‚³å»ºè¨­æ€§å…§é–£åå–®ï¼ˆPDFï¼‰</label>
    <input type="file" name="cabinet_pdf" accept="application/pdf">
    {% if party_doc and party_doc.cabinet_url %}
    <p><a href="{{ party_doc.cabinet_url }}" target="_blank">ğŸ“ å·²ä¸Šå‚³ï¼šé»æˆ‘ä¸‹è¼‰</a></p>
    {% endif %}

    <label>ä¸Šå‚³æ”¿é»¨è¯ç›Ÿå”å®šæ›¸ï¼ˆPDFï¼‰</label>
    <input type="file" name="alliance_pdf" accept="application/pdf">
    {% if party_doc and party_doc.alliance_url %}
    <p><a href="{{ party_doc.alliance_url }}" target="_blank">ğŸ“ å·²ä¸Šå‚³ï¼šé»æˆ‘ä¸‹è¼‰</a></p>
    {% endif %}

    <button type="submit" class="submit-button" {% if remaining_slots==0 %}disabled{% endif %}>
      æåå€™é¸äººèˆ‡ä¸Šå‚³æª”æ¡ˆ
    </button>
  </form>

  {% if existing_candidates %}
  <div class="existing-section">
    <h3>å·²æåå€™é¸äºº</h3>
    <ul class="existing-list">
      {% for c in existing_candidates %}
      <li>{{ c.name }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  {% elif role == "group" %}
  <div class="submit-header">
    <h2>æäº¤å…¬æŠ•æ¡ˆ</h2>
  </div>

  <form method="POST" enctype="multipart/form-data" class="submit-form">
    <label for="title">å…¬æŠ•æ¡ˆæ¨™é¡Œ</label>
    <input type="text" id="title" name="title" required placeholder="è«‹è¼¸å…¥æ¸…æ¥šæ˜ç¢ºçš„æ¨™é¡Œï¼Œä¾‹å¦‚ï¼šåå°è²ªæ±¡ç‰¹èµ¦æ³•æ¡ˆ">

    <label for="description">å…¬æŠ•æ¡ˆèªªæ˜</label>
    <textarea id="description" name="description" rows="4" placeholder="è«‹ç°¡è¦èªªæ˜æ­¤å…¬æŠ•æ¡ˆçš„èƒŒæ™¯ã€ç›®çš„æˆ–å½±éŸ¿..."></textarea>

    <label>ä¸Šå‚³å…¬æŠ•æ¡ˆ PDF</label>
    <div class="file-dropzone" id="dropzone">
      <p id="fileLabel" style="color: #ced4da;">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ PDF æª”æ¡ˆ</p>
      <input type="file" id="proposal_pdf" name="proposal_pdf" accept="application/pdf" hidden>
    </div>

    {% if proposal and proposal.file_url %}
    <p><a href="{{ proposal.file_url }}" target="_blank">ğŸ“ å·²ä¸Šå‚³ï¼šé»æˆ‘ä¸‹è¼‰</a></p>
    {% endif %}

    <button type="submit" class="submit-button">æäº¤å…¬æŠ•æ¡ˆ</button>
  </form>
  {% endif %}
</div>
{% endblock %}
